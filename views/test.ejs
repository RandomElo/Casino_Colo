<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Camera Viewer</title>
    </head>
    <body>
        <h1>Caméra Arrière du Téléphone</h1>
        <video id="videoElement" autoplay playsinline width="640" height="480"></video>
        <button id="captureButton">Capturer et envoyer l'image</button>

        <script>
            navigator.mediaDevices
                .getUserMedia({ video: { facingMode: "environment" } })
                .then(function (stream) {
                    var videoElement = document.getElementById("videoElement");
                    videoElement.srcObject = stream;
                })
                .catch(function (error) {
                    console.error("Erreur lors de l'accès à la caméra: ", error);
                });

            document.getElementById("captureButton").addEventListener("click", function () {
                var videoElement = document.getElementById("videoElement");
                var canvas = document.createElement("canvas");
                canvas.width = videoElement.videoWidth;
                canvas.height = videoElement.videoHeight;
                var context = canvas.getContext("2d");
                context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

                canvas.toBlob(function (blob) {
                    var formData = new FormData();
                    formData.append("image", blob, "capture.png"); // Ensure 'image' matches the expected field name

                    fetch("/gestion/test-upload", {
                        method: "POST",
                        body: formData,
                    })
                        .then((response) => response.json()) // Ensure the response is JSON
                        .then((data) => {
                            console.log("QR Code data:", data.data);
                            alert("QR Code : "+data.data)
                        })
                        .catch((error) => {
                            console.error("Erreur lors de l'envoi de l'image:", error);
                        });
                }, "image/png");
            });
        </script>
    </body>
</html>
